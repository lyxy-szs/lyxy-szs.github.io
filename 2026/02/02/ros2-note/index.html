<!DOCTYPE html>
<html lang="zh-CN">

<head><!-- hexo injector head_begin start --><link href="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end -->
    <script src="https://cdn.bootcss.com/typed.js/2.0.5/typed.js"></script>
    <!-- �ַ��������ӿ����� -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<!-- վ��Ԫ��Ϣ -->

    <meta name="author" content="Lyxy-szs">


    <meta name="subtitle" content="Shi">




<!-- ҳ����⶯̬���� -->

<title>ros2_note | Johnson</title>

<!-- ��վͼ�� -->

    <link rel="icon" href="/2.ico">


<!-- �Զ���CSS�б������������ü��أ� -->

    
    <link rel="stylesheet" href="/css/style.css">
    


<!-- �Զ���JS�б������������ü��أ� -->

    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="/js/tellu.js"></script>
    
    <script src="/js/typed.min.js"></script>
    


<!-- MathJax��ʽ��Ⱦ֧�� -->

    

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Johnson&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                <a class="menu-item" href="/archives">文章</a>
                
                <a class="menu-item" href="/categories">类别</a>
                
                <a class="menu-item" href="/tags">标签</a>
                
                <a class="menu-item" href="/links">友链</a>
                
                <a class="menu-item" href="/downloads">下载</a>
                
                
                <!-- 桌面端搜索按钮 -->
                <button class="search-btn menu-item" style="
                    background: transparent; 
                    border: none; 
                    cursor: pointer; 
                    font-size: inherit; 
                    color: inherit;
                    padding: 0 10px;
                ">
                    搜索
                </button>

                <!-- 恢复默认主题切换结构 -->
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <!-- 恢复默认结构：&nbsp;改为空格 -->
                    <a href="/">Johnson&#39;s Blog</a><a id="mobile-toggle-theme">· Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">
                    <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"/></svg>
                    <svg class="close-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"/></svg>
                </div>
            </div>
            <div class="menu" id="mobile-menu">
                
                <a class="menu-item" href="/archives">文章</a>
                
                <a class="menu-item" href="/categories">类别</a>
                
                <a class="menu-item" href="/tags">标签</a>
                
                <a class="menu-item" href="/links">友链</a>
                
                <a class="menu-item" href="/downloads">下载</a>
                

                <!-- 移动端搜索按钮 -->
                <button class="search-btn menu-item" style="
                    background: transparent; 
                    border: none; 
                    cursor: pointer; 
                    font-size: inherit; 
                    color: inherit;
                    padding: 10px 0;
                    width: 100%;
                    text-align: left;
                ">
                    搜索
                </button>
            </div>
        </div>
    </nav>

</header>

<div id="searchModal" style="
    display: none; 
    position: fixed; 
    top: 20%; 
    left: 50%; 
    transform: translateX(-50%); 
    background: transparent; 
    backdrop-filter: blur(8px); 
    -webkit-backdrop-filter: blur(8px); 
    padding: 20px; 
    border-radius: 12px; 
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); 
    z-index: 9999; 
    width: 80%; 
    max-width: 500px;
    border: 1px solid rgba(255, 255, 255, 0.1);
">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 id="searchTitle" style="margin: 0; font-size: 16px;">搜索文章</h3>
        <span class="search-close" style="cursor: pointer; font-size: 20px;">&times;</span>
    </div>
    <input type="text" id="searchInput" placeholder="输入关键词搜索..." style="
        width: 100%; 
        padding: 12px; 
        border: 1px solid #eee; 
        border-radius: 8px; 
        font-size: 14px;
        outline: none;
        box-sizing: border-box;
    ">
    <ul id="searchResult" style="list-style: none; padding: 0; margin-top: 15px; max-height: 300px; overflow-y: auto;"></ul>
</div>

<!-- 主题适配样式（优化搜索结果上下文和输入框样式） -->
<!-- 主题适配样式（优化搜索结果上下文和输入框样式） -->
<style>
    /* 白主题样式 - 搜索框和文字 */
    #searchTitle,
    #searchInput {
        color: #333 !important;
    }
    .search-close {
        color: #999 !important;
    }
    #searchInput {
        background: rgba(255, 255, 255, 0.85) !important;
        border-color: #ddd !important;
        color: #333 !important;
    }
    #searchResult li {
        border-bottom: 1px dashed #eee !important;
    }
    #searchInput::placeholder {
        color: #999 !important;
    }

    /* 搜索结果链接（文章名）样式 */
    #searchResult a {
        text-decoration: none;
        font-weight: 500;
        display: block;
        color: #333; /* 白主题下的文章名颜色 */
    }
    
    body.dark #searchResult a,
    body.dark-theme #searchResult a {
        color: #fff; /* 深色主题下的文章名颜色 */
    }

    /* 黑主题样式 - 搜索框和文字 */
    body.dark #searchTitle,
    body.dark-theme #searchTitle,
    body.dark #searchInput,
    body.dark-theme #searchInput {
        color: #fff !important;
    }
    body.dark .search-close,
    body.dark-theme .search-close {
        color: #ccc !important;
    }
    body.dark #searchInput,
    body.dark-theme #searchInput {
        background: rgba(50, 50, 50, 0.85) !important;
        border-color: #666 !important;
        color: #fff !important;
    }
    body.dark #searchResult li,
    body.dark-theme #searchResult li {
        border-bottom: 1px dashed #555 !important;
    }
    body.dark #searchInput::placeholder,
    body.dark-theme #searchInput::placeholder {
        color: #aaa !important;
    }

    /* 修改：搜索结果上下文样式 - 使用与文章名相同的颜色 */
    .search-context {
        display: block;
        font-size: 13px;
        margin-top: 6px;
        line-height: 1.5;
        height: 39px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        word-break: break-all;
        color: #333; /* 默认使用与文章名相同的浅色主题颜色 */
    }
    
    /* 深色主题下上下文使用与文章名相同的颜色 */
    body.dark .search-context,
    body.dark-theme .search-context {
        color: #fff; /* 使用与深色主题文章名相同的颜色 */
    }
    
    /* 保留关键词高亮样式 */
    .search-context mark {
        background-color: rgba(255, 215, 0, 0.3);
        color: inherit; /* 继承父元素的颜色 */
        padding: 0 2px;
        border-radius: 2px;
        font-weight: bold;
    }
    
    /* 深色主题下的关键词高亮 */
    body.dark .search-context mark,
    body.dark-theme .search-context mark {
        background-color: rgba(255, 215, 0, 0.4);
        color: #fff; /* 深色主题下mark标签文字颜色 */
    }

    /* ========== 搜索结果滚动条主题适配 ========== */
    /* 1. 白主题滚动条（默认） */
    #searchResult {
        scrollbar-width: thin;
        scrollbar-color: #ccc #f5f5f5;
    }
    
    /* 滚动条整体宽度 */
    #searchResult::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    
    /* 滚动条轨道 */
    #searchResult::-webkit-scrollbar-track {
        background: #f5f5f5;
        border-radius: 3px;
    }
    
    /* 滚动条滑块 */
    #searchResult::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }
    
    /* 滑块hover状态 */
    #searchResult::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    /* 2. 黑主题滚动条 */
    body.dark #searchResult,
    body.dark-theme #searchResult {
        scrollbar-width: thin;
        scrollbar-color: #666 #333;
    }
    
    body.dark #searchResult::-webkit-scrollbar-track,
    body.dark-theme #searchResult::-webkit-scrollbar-track {
        background: #333;
    }
    
    body.dark #searchResult::-webkit-scrollbar-thumb,
    body.dark-theme #searchResult::-webkit-scrollbar-thumb {
        background: #666;
    }
    
    body.dark #searchResult::-webkit-scrollbar-thumb:hover,
    body.dark-theme #searchResult::-webkit-scrollbar-thumb:hover {
        background: #888;
    }

    /* 3. 搜索结果项目样式 */
    #searchResult li {
        padding: 12px 0;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    body.dark #searchResult li,
    body.dark-theme #searchResult li {
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    /* 文章链接悬停效果 */
    #searchResult a:hover {
        text-decoration: underline;
    }
</style>

<!-- 引入jQuery和搜索逻辑JS -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
<script>
    // 移动菜单切换函数（保持不变）
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.classList.contains("active")) {
            toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        } else {
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }

    // 搜索功能逻辑（增加上下文提取功能）
    $(document).ready(function () {
        const $searchBtn = $('.search-btn');
        const $searchModal = $('#searchModal');
        const $searchInput = $('#searchInput');
        const $searchResult = $('#searchResult');

        // 显示/隐藏搜索框（保持不变）
        $searchBtn.click(function (e) {
            e.preventDefault();
            $searchModal.toggle();
            if ($searchModal.is(':visible')) {
                $searchInput.focus();
            } else {
                $searchInput.val('');
                $searchResult.empty();
            }
        });

        // 关闭搜索框（保持不变）
        $('.search-close').click(function () {
            $searchModal.hide();
            $searchInput.val('');
            $searchResult.empty();
        });

        // 点击外部关闭（保持不变）
        $(document).click(function (e) {
            if (
                !$searchModal.is(e.target) && 
                !$searchModal.has(e.target).length && 
                !$searchBtn.is(e.target)
            ) {
                $searchModal.hide();
                $searchInput.val('');
                $searchResult.empty();
            }
        });

        // 从文本中提取关键词上下文（优化版）
        function extractContext(text, keyword, maxLength = 150) {
            if (!text || !keyword) return '';
            
            // 将文本和关键词都转为小写进行匹配
            const lowerText = text.toLowerCase();
            const lowerKeyword = keyword.toLowerCase();
            
            // 查找关键词在文本中的位置
            const index = lowerText.indexOf(lowerKeyword);
            
            if (index === -1) {
                // 如果没有找到关键词，返回文本开头部分
                const shortText = text.substring(0, maxLength);
                return shortText + (text.length > maxLength ? '...' : '');
            }
            
            // 计算截取范围：关键词前后各取一半
            const start = Math.max(0, index - maxLength / 2);
            const end = Math.min(text.length, index + keyword.length + maxLength / 2);
            
            let context = text.substring(start, end);
            
            // 在开头和结尾添加省略号
            if (start > 0) context = '...' + context;
            if (end < text.length) context = context + '...';
            
            // 高亮关键词（保持原始大小写）
            const originalKeyword = text.substring(index, index + keyword.length);
            const regex = new RegExp(originalKeyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
            
            return context.replace(regex, match => `<mark>${match}</mark>`);
        }

        // 去除HTML标签，获取纯文本
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        // 关键词搜索（显示带上下文的搜索结果）
        $searchInput.on('input', function () {
            const searchText = $(this).val().trim().toLowerCase();
            $searchResult.empty();

            if (searchText.length < 2) return;

            $.get('/search.xml', function (xml) {
                let hasMatch = false;
                $(xml).find('entry').each(function () {
                    const $entry = $(this);
                    const title = $entry.find('title').text();
                    const link = $entry.find('url').text();
                    const rawContent = $entry.find('content').text();
                    const content = stripHtml(rawContent);
                    
                    // 搜索标题和内容
                    const titleMatch = title.toLowerCase().includes(searchText);
                    const contentMatch = content.toLowerCase().includes(searchText);
                    
                    if (titleMatch || contentMatch) {
                        // 提取上下文
                        let context = '';
                        if (contentMatch) {
                            context = extractContext(content, searchText, 150);
                        } else if (titleMatch) {
                            // 如果只是标题匹配，高亮标题中的关键词
                            const titleContext = title.replace(
                                new RegExp(searchText, 'gi'), 
                                match => `<mark>${match}</mark>`
                            );
                            context = `标题匹配: ${titleContext}`;
                        }
                        
                        $searchResult.append(`
                            <li>
                                <a href="${link}?keyword=${encodeURIComponent(searchText)}" target="_blank">
                                    ${title}
                                </a>
                                <span class="search-context">${context}</span>
                            </li>
                        `);
                        hasMatch = true;
                    }
                });

                if (!hasMatch) {
                    $searchResult.append(`
                        <li style="padding: 10px; text-align: center; color: #888;">
                            未找到包含"${searchText}"的文章
                        </li>
                    `);
                }
            }).fail(function () {
                $searchResult.append(`
                    <li style="padding: 10px; color: #f44336; text-align: center;">
                        搜索索引加载失败，请确保已生成search.xml
                    </li>
                `);
            });
        });
    });
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">ros2_note</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lyxy-szs</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">二月 2, 2026&nbsp;&nbsp;9:48:08</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="VScode"><a href="#VScode" class="headerlink" title="VScode"></a><strong>VScode</strong></h1><p><em><strong>首先，</strong></em> 先把VScode自动保存打开！！！<br>这样会减少很多的报错<br><img src="/images/ros_node/r-0.webp" alt="r-0" width="800" /></p>
<h1 id="指令："><a href="#指令：" class="headerlink" title="指令："></a>指令：</h1><details>
<summary> 基础 </summary>

<h2 id="召唤吉祥物"><a href="#召唤吉祥物" class="headerlink" title="召唤吉祥物"></a>召唤吉祥物</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node</span><br></pre></td></tr></table></figure>
<img src="/images/ros_node/r-1.1.webp" alt="r-1.1" width="500" />

<h2 id="查看服务列表，会显示服务类型及消息接口"><a href="#查看服务列表，会显示服务类型及消息接口" class="headerlink" title="查看服务列表，会显示服务类型及消息接口"></a>查看服务列表，会显示服务类型及消息接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 service list -t</span><br><span class="line"><span class="comment">#eg：/spawn[turtlesim/srv/Spawn],spawn是“产卵”，生成新的海龟</span></span><br></pre></td></tr></table></figure>
<h2 id="查看消息接口"><a href="#查看消息接口" class="headerlink" title="查看消息接口"></a>查看消息接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ros2 interface show turtlesim/srv/Spawn <span class="comment">#在上一条命令后，[]内的内容是接口</span></span><br><span class="line"><span class="comment">#float32 x       32位浮点型保存横坐标</span></span><br><span class="line"><span class="comment">#float32 y       32位浮点型保存纵坐标</span></span><br><span class="line"><span class="comment">#float32 theta   32位浮点型保存头的朝向</span></span><br><span class="line"><span class="comment">#string name # Optional.  A unique name will be created and returned if this is empty</span></span><br><span class="line"><span class="comment">#---</span></span><br><span class="line"><span class="comment">#string name</span></span><br></pre></td></tr></table></figure>
<h2 id="终端调用消息接口-召唤第二只乌龟"><a href="#终端调用消息接口-召唤第二只乌龟" class="headerlink" title="终端调用消息接口(召唤第二只乌龟)"></a>终端调用消息接口(召唤第二只乌龟)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ros2 service call /spawn turtlesim/srv/Spawn <span class="string">&quot;&#123;x: 1,y: 2&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#格式： ros2 service call 服务名字 服务接口 &quot;&#123;数据填充（yaml格式）&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<details>
<summary>示例反馈</summary>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">requester: making request: turtlesim.srv.Spawn_Request(x=1.0, y=2.0, theta=0.0, name=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">response:</span><br><span class="line">turtlesim.srv.Spawn_Response(name=<span class="string">&#x27;turtle2&#x27;</span>)</span><br></pre></td></tr></table></figure>
</details>

<img src="/images/ros_node/r-1.2.webp" alt="r-1.2" width="500" />

<h2 id="可视化接口调用：rqt"><a href="#可视化接口调用：rqt" class="headerlink" title="可视化接口调用：rqt"></a>可视化接口调用：rqt</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt</span><br></pre></td></tr></table></figure>
<img src="/images/ros_node/r-2.webp" alt="r-2" width="500" />
</details>

<h1 id="导-航-："><a href="#导-航-：" class="headerlink" title="导 航 ："></a>导 航 ：</h1><h2 id="创建环境："><a href="#创建环境：" class="headerlink" title="创建环境："></a>创建环境：</h2><h3 id="创建并进入文件夹"><a href="#创建并进入文件夹" class="headerlink" title="创建并进入文件夹"></a>创建并进入文件夹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> CHAPT6/chapt6_ws/src &amp;&amp; <span class="built_in">cd</span> CHAPT6/chapt6_ws/src</span><br></pre></td></tr></table></figure>

<h3 id="创建ros2环境"><a href="#创建ros2环境" class="headerlink" title="创建ros2环境"></a>创建ros2环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create fishbot_description --build-type ament_cmake --license Apache-2.0</span><br></pre></td></tr></table></figure>

<p>对照表：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg       create  fishbot_description   --build-type  ament_cmake                    --license     Apache-2.0</span><br><span class="line">ros2 功能包操作  创建    fishbot_description   -- 构建类型     ROS 2 中基于 CMake 的标准构建方式 -- 开源许可证   Apache 2.0 协议</span><br></pre></td></tr></table></figure>

<details>
<summary> 示例反馈： </summary>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">going to create a new package</span><br><span class="line">package name: fishbot_description</span><br><span class="line">destination directory: /home/noi/fishros/CHAPT6/chapt6_ws/src</span><br><span class="line">package format: 3</span><br><span class="line">version: 0.0.0</span><br><span class="line">description: TODO: Package description</span><br><span class="line">maintainer: [<span class="string">&#x27;noi &lt;example@example.com&gt;&#x27;</span>]</span><br><span class="line">licenses: [<span class="string">&#x27;Apache-2.0&#x27;</span>]</span><br><span class="line">build <span class="built_in">type</span>: ament_cmake</span><br><span class="line">dependencies: []</span><br><span class="line">creating folder ./fishbot_description</span><br><span class="line">creating ./fishbot_description/package.xml</span><br><span class="line">creating <span class="built_in">source</span> and include folder</span><br><span class="line">creating folder ./fishbot_description/src</span><br><span class="line">creating folder ./fishbot_description/include/fishbot_description</span><br><span class="line">creating ./fishbot_description/CMakeLists.txt</span><br></pre></td></tr></table></figure>
<p>workplace：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── CHAPT6</span><br><span class="line">    └── chapt6_ws</span><br><span class="line">        └── src</span><br><span class="line">            └── fishbot_description</span><br><span class="line">                ├── CMakeLists.txt</span><br><span class="line">                ├── include</span><br><span class="line">                │   └── fishbot_description</span><br><span class="line">                ├── LICENSE</span><br><span class="line">                ├── package.xml</span><br><span class="line">                ├── urdf</span><br><span class="line">                └── src</span><br><span class="line"></span><br><span class="line">7 directories, 3 files</span><br></pre></td></tr></table></figure>
</details>

<h2 id="机器人模型文件储存-——-urdf文件夹"><a href="#机器人模型文件储存-——-urdf文件夹" class="headerlink" title="机器人模型文件储存 —— urdf文件夹"></a>机器人模型文件储存 —— urdf文件夹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> fishbot_description &amp;&amp; <span class="built_in">mkdir</span> urdf <span class="comment">#urdf 用于存放机器人模型文件</span></span><br><span class="line"><span class="built_in">cd</span> urdf &amp;&amp; <span class="built_in">touch</span> first_robot.urdf <span class="comment">#创建 urdf 文件</span></span><br></pre></td></tr></table></figure>
<p>另外需要手动在vscode中安装 urdf 插件<br><img src="/images/ros_node/r-3.1.webp" alt="urdf插件示意图" width="700" /></p>
<h3 id="编辑first-robot-urdf"><a href="#编辑first-robot-urdf" class="headerlink" title="编辑first_robot.urdf"></a>编辑first_robot.urdf</h3><details>
<summary> first_robot.urdf的内容 </summary>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;first&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的身体部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 圆柱体 radius半径 0.10m length高度 0.12m --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;0.10&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.12&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span></span><br><span class="line">       #requester: making request: turtlesim.srv.Spawn_Request(x=1.0, y=2.0, theta=0.0, name=&#x27;&#x27;)</span><br><span class="line">#</span><br><span class="line">#response:</span><br><span class="line">#turtlesim.srv.Spawn_Response(name=&#x27;turtle2&#x27;)         <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的IMU部件，惯性测量传感器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;imu_link&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.02 0.02 0.02&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.0 0.0 0.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的关节，用于组合机器人的部件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;imu_joint&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.03&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;imu_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>
</details>

<p><strong>打开集成终端</strong><br><img src="/images/ros_node/r-3.2.webp" alt="打开集成终端" width="400" /><br>输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#urdf_to_graphviz生成可视化文件(pdf,gv)</span></span><br><span class="line">urdf_to_graphviz first_robot.urdf </span><br></pre></td></tr></table></figure>
<details>
<summary> 如果报错 </summary>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WARNING: OUTPUT not given. This <span class="built_in">type</span> of usage is deprecated!Usage: urdf_to_graphviz input.xml [OUTPUT]  Will create either <span class="variable">$ROBOT_NAME</span>.gv &amp; <span class="variable">$ROBOT_NAME</span>.pdf <span class="keyword">in</span> CWD  or OUTPUT.gv &amp; OUTPUT.pdf.</span><br><span class="line">Error:   No <span class="built_in">link</span> elements found <span class="keyword">in</span> urdf file</span><br><span class="line">         at line 206 <span class="keyword">in</span> ./urdf_parser/src/model.cpp</span><br><span class="line">ERROR: Model Parsing the xml failed</span><br></pre></td></tr></table></figure>
则是urdf文件没有保存，ctrl+s 保存一下，如果你已经设置了vscode，这个错误基本不会发生
</details>

<h3 id="在RViz中查看模型"><a href="#在RViz中查看模型" class="headerlink" title="在RViz中查看模型"></a>在RViz中查看模型</h3><p>在集成终端中输入<code>rviz2</code></p>
<details>
<summary> 如果报错（简易方法） </summary>
如果rviz2发生渲染问题：如屏闪
Step1：更新显卡驱动（ai）
Step2：
复制到命令行

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line"><span class="built_in">tee</span> -a ~/.bashrc &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Function: renv (make a env for rviz2) ---</span></span><br><span class="line"><span class="function"><span class="title">renv</span></span>()&#123;</span><br><span class="line">    <span class="comment"># 设置环境变量以启用软件渲染和潜在的 Qt 兼容性</span></span><br><span class="line">    <span class="built_in">export</span> LIBGL_ALWAYS_SOFTWARE=1</span><br><span class="line">    <span class="built_in">export</span> QT_ENABLE_HIGHDPI_SCALING=0</span><br><span class="line">    <span class="built_in">export</span> vblank_mode=0</span><br><span class="line">    <span class="built_in">export</span> QT_XCB_GL_INTEGRATION=xcb_glx</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># --- End of renv function ---</span></span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sources .bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再不行就ai 电脑型号 系统 情况 </p>
</details>

<img src="/images/ros_node/r-6.webp" alt="基础配置rviz2_1" width="700" />
----------------------------我是分割线-----------------------------
<img src="/images/ros_node/r-7.webp" alt="基础配置rviz2_2" width="700" />
但是当前还是无法直接显示imu_link base_link之间的关系，原因是rviz2默认使用map，需要tf变换

<p><strong>So，</strong> 使用ROS2内置的publisher实现自动的关系转换<br><img src="/images/ros_node/r-8.webp" alt="转换到rviz2的示意图" width="600" /><br>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install ros-<span class="variable">$ROS_DISTRO</span>-joint-state-publisher</span><br><span class="line"><span class="built_in">sudo</span> apt install ros-<span class="variable">$ROS_DISTRO</span>-robot-state-publisher</span><br></pre></td></tr></table></figure>

<h2 id="编辑launch文件（方便运行-关闭多个节点）"><a href="#编辑launch文件（方便运行-关闭多个节点）" class="headerlink" title="编辑launch文件（方便运行&#x2F;关闭多个节点）"></a>编辑launch文件（方便运行&#x2F;关闭多个节点）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/fishros/CHAPT6</span><br><span class="line"><span class="built_in">mkdir</span> -p chapt6_ws/src/fishbot_description/launch</span><br><span class="line"><span class="built_in">touch</span> chapt6_ws/src/fishbot_description/launch/display_robot.launch.py</span><br></pre></td></tr></table></figure>

<details>
<summary> display_robot.launch.py的内容 </summary>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">import</span> launch_rosdisplay_robot.launch.py</span><br><span class="line"><span class="keyword">from</span> ament_index_python.packages <span class="keyword">import</span> get_package_share_directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment">#获取默认的urdf路径,这个需要先colcon build 一下，并且在CMakeList中加上urdf与launch文件夹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> launch.LaunchDescription([</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#CMakeList.txt</span><br><span class="line">#......</span><br><span class="line">#endif()</span><br><span class="line"></span><br><span class="line">#自己定位一下吧</span><br><span class="line">install(DIRECTORY launch urdf </span><br><span class="line">  DESTINATION share/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ament_package()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</details>

<p>这里有点麻烦，建议直接看<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vq2LYoECn?t=394.7">鱼香ros视频</a>，</p>
<details>
<summary>文字解析附上</summary>

<h2 id="ROS-2-Launch-文件详解"><a href="#ROS-2-Launch-文件详解" class="headerlink" title="ROS 2 Launch 文件详解"></a>ROS 2 Launch 文件详解</h2><p>ps：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vq2LYoECn?t=1334.7">config文件怎么出来的</a></p>
<p>这是一个用于启动 <code>fishbot_description</code> 机器人描述相关节点的 ROS 2 Launch 文件。它会加载 URDF 模型、发布机器人状态，并启动 RViz2 进行可视化。</p>
<details>
<summary>display_robot.launch.py完整代码与对应CMakeList.txt</summary>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#CMakeList.txt</span><br><span class="line">#......</span><br><span class="line">#endif()</span><br><span class="line"></span><br><span class="line">#自己定位一下吧</span><br><span class="line">install(DIRECTORY launch urdf config</span><br><span class="line">  DESTINATION share/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ament_package()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#display_robot.launch.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">import</span> launch_ros</span><br><span class="line"><span class="keyword">from</span> ament_index_python.packages <span class="keyword">import</span> get_package_share_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment"># 获取默认的urdf路径</span></span><br><span class="line">    urdf_package_path = get_package_share_directory(<span class="string">&#x27;fishbot_description&#x27;</span>)</span><br><span class="line">    default_urdf_path = os.path.join(urdf_package_path, <span class="string">&#x27;urdf&#x27;</span>, <span class="string">&#x27;first_robot.urdf&#x27;</span>)</span><br><span class="line">    default_rviz_config_path = os.path.join(urdf_package_path, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;display_robot_model.rviz&#x27;</span>)</span><br><span class="line">    <span class="comment"># 1. 修复：launch.action → launch.actions（加s）</span></span><br><span class="line">    action_declear_arg_mode_path = launch.actions.DeclareLaunchArgument(</span><br><span class="line">        name=<span class="string">&#x27;model&#x27;</span>,</span><br><span class="line">        default_value=<span class="built_in">str</span>(default_urdf_path),</span><br><span class="line">        description=<span class="string">&#x27;加载的模型文件路径&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 修复：换行语法错误（加\或调整括号）</span></span><br><span class="line">    substitutions_command_result = launch.substitutions.Command(</span><br><span class="line">        [<span class="string">&#x27;cat &#x27;</span>, launch.substitutions.LaunchConfiguration(<span class="string">&#x27;model&#x27;</span>)]</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 构建机器人描述参数值</span></span><br><span class="line">    robot_state_publisher_value = launch_ros.parameter_descriptions.ParameterValue(</span><br><span class="line">        substitutions_command_result,</span><br><span class="line">        value_type=<span class="built_in">str</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 修复：参数名 robot_state_publisher → robot_description</span></span><br><span class="line">    action_robot_state_publisher = launch_ros.actions.Node(</span><br><span class="line">        package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        parameters=[&#123;<span class="string">&#x27;robot_description&#x27;</span>: robot_state_publisher_value&#125;]</span><br><span class="line">        <span class="comment"># parameters is professional for point == ros2 run rviz2 rviz2 --ros-args -p xx:=xxxvalue</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    action_joint_state_publisher = launch_ros.actions.Node(</span><br><span class="line">        package=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    action_rviz_node = launch_ros.actions.Node(</span><br><span class="line">        package=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">        arguments=[<span class="string">&#x27;-d&#x27;</span>, default_rviz_config_path]</span><br><span class="line">      <span class="comment"># add function after rviz == ros2 run rviz2 rviz2 -d /home/noi/fishros/CHAPT6/chapt6_ws/src/fishbot_description/config/display_robot_model.rviz</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> launch.LaunchDescription([</span><br><span class="line">        action_declear_arg_mode_path,</span><br><span class="line">        action_robot_state_publisher,</span><br><span class="line">        action_joint_state_publisher,</span><br><span class="line">        action_rviz_node,</span><br><span class="line">    ])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<h3 id="文件结构与导入"><a href="#文件结构与导入" class="headerlink" title="文件结构与导入"></a>文件结构与导入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">import</span> launch_ros</span><br><span class="line"><span class="keyword">from</span> ament_index_python.packages <span class="keyword">import</span> get_package_share_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Shebang:</strong> <code>#!/usr/bin/env python3</code> 指定了运行此脚本的解释器。</li>
<li><strong>导入模块:</strong><ul>
<li><code>launch</code>: ROS 2 Launch 系统的核心模块，提供基础功能。</li>
<li><code>launch_ros</code>: ROS 2 特定的 Launch 功能，例如启动 ROS 节点。</li>
<li><code>get_package_share_directory</code>: 用于获取指定包的共享目录路径（通常是 <code>share/package_name</code>）。</li>
<li><code>os</code>: Python 标准库，用于路径操作。</li>
</ul>
</li>
</ul>
<h3 id="主函数-generate-launch-description"><a href="#主函数-generate-launch-description" class="headerlink" title="主函数 generate_launch_description"></a>主函数 <code>generate_launch_description</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br></pre></td></tr></table></figure>

<p>这是 Launch 文件的入口函数。ROS 2 启动系统会调用此函数来获取需要执行的动作列表。</p>
<h4 id="获取资源路径"><a href="#获取资源路径" class="headerlink" title="获取资源路径"></a>获取资源路径</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urdf_package_path = get_package_share_directory(<span class="string">&#x27;fishbot_description&#x27;</span>)</span><br><span class="line">default_urdf_path = os.path.join(urdf_package_path, <span class="string">&#x27;urdf&#x27;</span>, <span class="string">&#x27;first_robot.urdf&#x27;</span>)</span><br><span class="line">default_rviz_config_path = os.path.join(urdf_package_path, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;display_robot_model.rviz&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>get_package_share_directory(&#39;fishbot_description&#39;)</code>: 获取 <code>fishbot_description</code> 包的安装路径。</li>
<li><code>os.path.join(...)</code>: 安全地将目录和文件名拼接成完整路径。</li>
<li>获取了默认的 URDF 文件路径和 RViz2 配置文件路径。</li>
</ul>
<h4 id="定义启动参数"><a href="#定义启动参数" class="headerlink" title="定义启动参数"></a>定义启动参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action_declear_arg_mode_path = launch.actions.DeclareLaunchArgument(</span><br><span class="line">    name=<span class="string">&#x27;model&#x27;</span>,</span><br><span class="line">    default_value=<span class="built_in">str</span>(default_urdf_path),</span><br><span class="line">    description=<span class="string">&#x27;加载的模型文件路径&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>launch.actions.DeclareLaunchArgument</code>: 创建一个声明启动参数的动作。</li>
<li><code>name=&#39;model&#39;</code>: 参数名为 <code>model</code>。</li>
<li><code>default_value=...</code>: 如果启动时未提供 <code>model</code> 参数，则使用 <code>default_urdf_path</code> 作为默认值。</li>
<li><code>description=...</code>: 为此参数提供描述信息。</li>
<li>这个参数允许用户在启动时动态指定不同的 URDF 文件，例如：<code>ros2 launch &lt;package&gt; &lt;launch_file&gt; model:=/path/to/my_custom.urdf</code></li>
</ul>
<h4 id="处理-URDF-文件内容"><a href="#处理-URDF-文件内容" class="headerlink" title="处理 URDF 文件内容"></a>处理 URDF 文件内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">substitutions_command_result = launch.substitutions.Command(</span><br><span class="line">    [<span class="string">&#x27;cat &#x27;</span>, launch.substitutions.LaunchConfiguration(<span class="string">&#x27;model&#x27;</span>)]</span><br><span class="line">)</span><br><span class="line">robot_state_publisher_value = launch_ros.parameter_descriptions.ParameterValue(</span><br><span class="line">    substitutions_command_result,</span><br><span class="line">    value_type=<span class="built_in">str</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>launch.substitutions.LaunchConfiguration(&#39;model&#39;)</code>: 获取 <code>model</code> 参数的实际值（可能是默认值，也可能是用户传入的值）。</li>
<li><code>launch.substitutions.Command([...])</code>: 执行一个系统命令（这里是 <code>cat</code> 命令）并将结果作为字符串返回。<code>[&#39;cat &#39;, ...]</code> 拼接起来就是 <code>cat /path/to/urdf/file.urdf</code>，它会输出整个 URDF 文件的内容。</li>
<li><code>launch_ros.parameter_descriptions.ParameterValue(...)</code>: 将命令执行的结果包装成一个可以在 ROS 2 节点参数中使用的对象。</li>
</ul>
<h4 id="启动-robot-state-publisher-节点"><a href="#启动-robot-state-publisher-节点" class="headerlink" title="启动 robot_state_publisher 节点"></a>启动 <code>robot_state_publisher</code> 节点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action_robot_state_publisher = launch_ros.actions.Node(</span><br><span class="line">    package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    parameters=[&#123;<span class="string">&#x27;robot_description&#x27;</span>: robot_state_publisher_value&#125;]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>launch_ros.actions.Node</code>: 创建一个启动 ROS 节点的动作。</li>
<li><code>package=&#39;robot_state_publisher&#39;</code>: 指定节点所在的包。</li>
<li><code>executable=&#39;robot_state_publisher&#39;</code>: 指定要运行的可执行文件名称（通常与包同名）。</li>
<li><code>parameters=[...]</code>: 设置节点启动时的参数。<ul>
<li><code>&#123;&#39;robot_description&#39;: ...&#125;</code>: 设置名为 <code>robot_description</code> 的参数，其值为之前通过 <code>ParameterValue</code> 包装的 URDF 内容。<code>robot_state_publisher</code> 节点会读取这个参数来获取机器人模型定义。</li>
</ul>
</li>
</ul>
<h4 id="启动-joint-state-publisher-节点"><a href="#启动-joint-state-publisher-节点" class="headerlink" title="启动 joint_state_publisher 节点"></a>启动 <code>joint_state_publisher</code> 节点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">action_joint_state_publisher = launch_ros.actions.Node(</span><br><span class="line">    package=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>这个节点通常用于发布机器人的关节状态（如位置、速度、力矩）。对于有活动关节的机器人，它是必需的。如果没有活动关节，有时可以用 <code>joint_state_publisher_gui</code> 或者不启动它（如果其他节点会发布关节状态）。</li>
</ul>
<h4 id="启动-rviz2-节点"><a href="#启动-rviz2-节点" class="headerlink" title="启动 rviz2 节点"></a>启动 <code>rviz2</code> 节点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action_rviz_node = launch_ros.actions.Node(</span><br><span class="line">    package=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-d&#x27;</span>, default_rviz_config_path]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>arguments=[&#39;-d&#39;, ...]</code>: 向 <code>rviz2</code> 可执行文件传递启动参数。<code>-d</code> 是 RViz2 的一个命令行选项，用于指定加载的配置文件。这里传入了预先获取的 <code>default_rviz_config_path</code>，这样 RViz2 会自动加载预设的显示配置。</li>
</ul>
<h4 id="返回启动描述"><a href="#返回启动描述" class="headerlink" title="返回启动描述"></a>返回启动描述</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> launch.LaunchDescription([</span><br><span class="line">    action_declear_arg_mode_path,</span><br><span class="line">    action_robot_state_publisher,</span><br><span class="line">    action_joint_state_publisher,</span><br><span class="line">    action_rviz_node,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<ul>
<li><code>launch.LaunchDescription([...])</code>: 将所有需要执行的动作（<code>action_...</code>）放入一个列表中，并创建一个 <code>LaunchDescription</code> 对象返回。</li>
<li>ROS 2 Launch 系统会依次执行这个列表中的所有动作，从而启动所有定义的节点和参数。</li>
</ul>
<p>运行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 launch fishbot_description display_robot.launch.py</span><br></pre></td></tr></table></figure>

</details>

<h2 id="使用Xacro简化URDF"><a href="#使用Xacro简化URDF" class="headerlink" title="使用Xacro简化URDF"></a>使用Xacro简化URDF</h2><p>先创建一个xacro文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/your/chapt6_ws <span class="comment">#到工作空间的路径，自己改一下</span></span><br><span class="line"><span class="built_in">touch</span> src/urdf/first_robot.xacro <span class="comment">#与first_robot.urdf同文件夹下创建first_robot.xacro</span></span><br></pre></td></tr></table></figure>

<p><strong>格式对照</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_robot&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span> <span class="attr">params</span>=<span class="string">&quot;length radius&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 机器人的身体部分 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 圆柱体 radius半径 0.10m length高度 0.12m --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;length&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;first_robot&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的身体部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 圆柱体 radius半径 0.10m length高度 0.12m --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;0.10&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.12&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Xacro语法"><a href="#Xacro语法" class="headerlink" title="Xacro语法"></a>Xacro语法</h3><table>
<thead>
<tr>
<th align="left">步骤</th>
<th align="left">说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1. 添加 Wiki 指向</td>
<td align="left">在 <code>robot</code> 标签中声明 <code>xmlns:xacro</code> 属性，指向 ROS Wiki。</td>
<td align="left"><code>&lt;robot xmlns:xacro=&quot;http://www.ros.org/wiki/xacro&quot; name=&quot;first_robot&quot;&gt;</code></td>
</tr>
<tr>
<td align="left">2. 定义宏（模块）</td>
<td align="left">使用 <code>&lt;xacro:macro&gt;</code> 标签定义一个可重用的模块，并声明所需的参数（变量）。</td>
<td align="left"><code>&lt;xacro:macro name=&quot;模块名&quot; params=&quot;变量名1 变量名2&quot;&gt;</code></td>
</tr>
<tr>
<td align="left">3. 使用变量</td>
<td align="left">在宏定义内部，通过 <code>$&#123;变量名&#125;</code> 的语法来引用和使用参数。</td>
<td align="left"><code>&lt;cylinder radius=&quot;$&#123;变量名1&#125;&quot; length=&quot;$&#123;变量名2&#125;&quot;/&gt;</code></td>
</tr>
<tr>
<td align="left">4. 闭合宏定义</td>
<td align="left">使用 <code>&lt;/xacro:macro&gt;</code> 标签来正确闭合宏定义，确保其内部所有 XML 标签均已闭合。</td>
<td align="left"><code>&lt;/xacro:macro&gt;</code></td>
</tr>
<tr>
<td align="left">5. 调用宏</td>
<td align="left">在 <code>robot</code> 文件结束前，使用 <code>&lt;xacro:宏名 参数1=&quot;值&quot; 参数2=&quot;值&quot; /&gt;</code> 的语法来实例化宏。</td>
<td align="left"><code>&lt;xacro:模块名 变量名1=&quot;赋值&quot; 变量名2=&quot;赋值&quot;/&gt;</code></td>
</tr>
</tbody></table>
<details>
<summary>完整文件，可以自行对比</summary>
<details>
<summary>first_robot.xacro</summary>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_robot&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span> <span class="attr">params</span>=<span class="string">&quot;length radius&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 机器人的身体部分 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 圆柱体 radius半径 0.10m length高度 0.12m --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;length&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;imu_link&quot;</span> <span class="attr">params</span>=<span class="string">&quot;imu_name xyz&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 机器人的IMU部件，惯性测量传感器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;imu_name&#125;_link&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.02 0.02 0.02&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.0 0.0 0.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 机器人的关节，用于组合机器人的部件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;imu_name&#125;_joint&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;xyz&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;$&#123;imu_name&#125;_link&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 修正：child link 名称应与 link name 匹配 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span> <span class="comment">&lt;!-- 这里正确闭合了 imu_link 宏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 调用宏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:base_link</span> <span class="attr">length</span>=<span class="string">&quot;0.12&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:imu_link</span> <span class="attr">imu_name</span>=<span class="string">&quot;imu_up&quot;</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.03&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:imu_link</span> <span class="attr">imu_name</span>=<span class="string">&quot;imu_down&quot;</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 -0.03&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span> <span class="comment">&lt;!-- 整个 robot 文件也正确闭合 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<details>
<summary>first_robot.urdf</summary>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;first_robot&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的身体部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 圆柱体 radius半径 0.10m length高度 0.12m --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;0.10&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.12&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的IMU部件，惯性测量传感器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;imu_link&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 部件外观描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 沿着自己几何中心的偏移和旋转量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 几何形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.02 0.02 0.02&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 材质颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 红绿蓝 透明度（0～1） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.0 0.0 0.0 0.5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 机器人的关节，用于组合机器人的部件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;imu_joint&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0.0 0.03&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0.0 0.0 0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;imu_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

</details>

</details>

<h3 id="Xacro转为URDF"><a href="#Xacro转为URDF" class="headerlink" title="Xacro转为URDF"></a>Xacro转为URDF</h3><p><strong>下载转换器：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install ros-<span class="variable">$ROS_DISTRO</span>-xacro</span><br></pre></td></tr></table></figure>
<p><strong>运行转换器：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xacro /path/to/your/xacrofile</span><br></pre></td></tr></table></figure>
<details>
<summary> 报错eg:（点击打开查看）</summary>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XML parsing error: mismatched tag: line 52, column 2</span><br><span class="line">when processing file: /home/noi/fishros/CHAPT6/chapt6_ws/src/fishbot_description/urdf/first_robot.xacro</span><br><span class="line"></span><br><span class="line">Check that:</span><br><span class="line"> - Your XML is well-formed</span><br><span class="line"> - You have the xacro xmlns declaration: xmlns:xacro=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span></span><br></pre></td></tr></table></figure>
<p>这说明你有语法错误，改一下</p>
</details>

<p>这个时候可以将原本的<code>display_robot.launch.py</code>中导入urdf文件的命令改为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自己匹配一下</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 修复：换行语法错误（加\或调整括号）</span></span><br><span class="line">    substitutions_command_result = launch.substitutions.Command(</span><br><span class="line">        [<span class="string">&#x27;xacro &#x27;</span>, launch.substitutions.LaunchConfiguration(<span class="string">&#x27;model&#x27;</span>)]</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 构建机器人描述参数值</span></span><br><span class="line">    robot_state_publisher_value = launch_ros.parameter_descriptions.ParameterValue(</span><br><span class="line">        substitutions_command_result,</span><br><span class="line">        value_type=<span class="built_in">str</span></span><br><span class="line">    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/your/chapt6_ws <span class="comment">#到工作空间的路径，自己改一下</span></span><br><span class="line">colcon build</span><br><span class="line"><span class="built_in">source</span> install/setup.bash</span><br><span class="line">ros2 launch fishbot_description display_robot.launch.py model:=/path/to/your/chapt6_ws/install/fishbot_description/share/fishbot_description/urdf/first_robot.xacro  <span class="comment">#到工作空间的路径，自己改一下</span></span><br></pre></td></tr></table></figure>

<p><strong>Xacro标签的好处：</strong></p>
<ul>
<li>1、使用与声明分开，看起来简洁</li>
<li>2、可以批量生成类似的元素</li>
<li><del>3、降低维护成本</del></li>
</ul>
<h2 id="Xacro使用示例"><a href="#Xacro使用示例" class="headerlink" title="Xacro使用示例"></a>Xacro使用示例</h2><p><a href="/downloads/ros_node/fishbot.zip">fishbot</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lyxy-szs</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://lyxy-szs.github.io/2026/02/02/ros2-note/">http://lyxy-szs.github.io/2026/02/02/ros2-note/</a></span>
                    </p>
                
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>永远相信<strong>美好的事情即将發生</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/ROS2/"># ROS2</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2026/02/18/%E7%A7%91%E7%9B%AE%E4%B8%80/">科目一</a>
            
            
            <a class="next" rel="next" href="/2026/01/20/C++&note2/">C++/note2</a>
            
        </section>


    </article>
</div>

<!-- �����ڹؼ��ʶ�λ+�����߼� -->
<script>
// 1. ��URL�л�ȡ�ؼ��ʲ���
function getUrlParam(name) {
  const reg = new RegExp(`(^|&)${name}=([^&]*)(&|$)`);
  const r = window.location.search.substr(1).match(reg);
  if (r != null) return decodeURIComponent(r[2]);
  return null;
}

// 2. �������������ؼ���λ��
function highlightAndScrollToKeyword() {
  const keyword = getUrlParam('keyword');
  if (!keyword || keyword.length < 2) return; // �޹ؼ���/�ؼ��ʹ���������

  // ��λ������������Chic�����������ݵ�������������ȷ���Ƿ�ƥ�䣬Ĭ����.post-content��
  const contentEl = document.querySelector('.post-content');
  if (!contentEl) return;

  // ��¡���ݣ�����ֱ���޸�ԭDOM���µ�����
  const contentHtml = contentEl.innerHTML;
  // ����ƥ��ؼ��ʣ����Դ�Сд��ȫ��ƥ�䣩
  const reg = new RegExp(`(${keyword})`, 'gi');
  // �滻�ؼ��ʲ����Ӹ�����ʽ
  const newHtml = contentHtml.replace(reg, '<span style="background: #ffff00; color: #333; padding: 0 2px; border-radius: 2px;">$1</span>');
  contentEl.innerHTML = newHtml;

  // 3. ��������һ��ƥ��Ĺؼ���λ��
  const firstHighlight = contentEl.querySelector('span[style*="background: #ffff00"]');
  if (firstHighlight) {
    // ƽ���������ؼ���λ�ã�ƫ��-80px�����ⱻ�������ڵ���
    firstHighlight.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
    // ����һ������Ԫ��������˸Ч������ǿ�Ӿ���ʾ
    firstHighlight.animate([
      { opacity: 0.5 },
      { opacity: 1 }
    ], {
      duration: 1000,
      iterations: 2
    });
  }
}

// ҳ�������ɺ�ִ��
window.onload = function() {
  highlightAndScrollToKeyword();
};
</script>
            </div>
            <footer id="footer" class="footer">
    <div class="footer-typing-container">
        <span id="footer-typed-text"></span>
    </div>
    <div class="copyright">
        <span>© Lyxy-szs | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

<script>
    // 等待页面文档加载完毕
    document.addEventListener('DOMContentLoaded', function () {
        // 确保容器元素存在
        const typedElement = document.getElementById('footer-typed-text');
        if (typedElement) {
            var typed = new Typed('#footer-typed-text', {
                strings: [
                    "永远相信 美好的事情即将發生 临渊羡鱼shi",
                    "知识就是力量。 弗朗西斯·培根",  
                    "我思故我在。 勒内·笛卡尔",  
                    "人生苦短，及时行乐。 贺拉斯",  
                    "活着就是为了改变世界，难道还有其他原因吗？ 史蒂夫·乔布斯",  
                    "黑暗不能驱走黑暗，只有光可以做到；仇恨不能驱走仇恨，只有爱可以做到。 马丁·路德·金",  
                    "成功是从一个失败到另一个失败而不失去热情的能力。 温斯顿·丘吉尔",  
                    "教育不是填满一个桶，而是点燃一把火。 威廉·巴特勒·叶芝",  
                    "战争就是和平，自由就是奴役，无知就是力量。 乔治·奥威尔《一九八四》",  
                    "人是为了反抗而生的。 阿尔贝·加缪",  
                    "幸福取决于我们自己。 亚里士多德",  
                    "唯一值得我们恐惧的是恐惧本身。 富兰克林·D·罗斯福",  
                    "生命的意义在于给予。 列夫·托尔斯泰",  
                    "不要为小事烦恼，所有事都是小事。 理查德·卡尔森",  
                    "梦想不会通过魔法实现；它需要汗水、决心和努力。 科林·鲍威尔",  
                    "最好的报复是巨大的成功。 弗兰克·辛纳屈",  
                    "你只活一次，但如果你做得对，一次就足够了。 梅·韦斯特"
                ], // 字符串数组，会依次键入
                typeSpeed: 60,    // 打字速度，数值越小越快[citation:2]
                backSpeed: 40,    // 回退删除的速度[citation:2]
                backDelay: 1500,  // 一句打完后的暂停时间（毫秒）[citation:2]
                loop: true,       // 是否循环[citation:2]
                showCursor: true, // 是否显示闪烁光标[citation:4]
                cursorChar: '_'   // 自定义光标字符[citation:4]
            });
        }
    });
</script>
    </div>
    
    
<script src="/js/scrollbar.js"></script>

    
<script src="/js/typed.min.js"></script>

    
<script src="/js/tellu.js"></script>

<!-- hexo injector body_end start --><script src="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.2.0/js/index.js"></script><!-- hexo injector body_end end --></body>

</html>